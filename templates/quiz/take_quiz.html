{% extends 'base.html' %}
{% block content %}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>{{ quiz.title }}</h2>
    <div id="timer" class="fs-4 text-danger">Time Left: <span id="time">{{ quiz.duration|stringformat:"02d" }}:00</span></div>
  </div>
  <form method="post" id="quizForm">
    {% csrf_token %}
    {% for question, answers in q_and_answers %}
      <div class="mb-4">
        <p class="fw-bold">{{ forloop.counter }}. {{ question.text }}</p>
        {% for answer in answers %}
          <div class="form-check">
            <input class="form-check-input" type="radio" name="{{ question.id }}" id="ans{{ answer.id }}" value="{{ answer.id }}">
            <label class="form-check-label" for="ans{{ answer.id }}">{{ answer.text }}</label>
          </div>
        {% endfor %}
      </div>
    {% endfor %}
    <button type="submit" class="btn btn-primary">Submit Answers</button>
  </form>
  <script>
    let totalSeconds = {{ quiz.duration }} * 60;
    const timer = document.getElementById('time');
    const form = document.getElementById('quizForm');
    const intv = setInterval(() => {
      let m = String(Math.floor(totalSeconds/60)).padStart(2,'0');
      let s = String(totalSeconds%60).padStart(2,'0');
      timer.textContent = m + ':' + s;
      if(totalSeconds-- <= 0){ clearInterval(intv); form.submit(); }
    },1000);
    history.pushState(null, '', location.href);
    window.addEventListener('popstate', () => history.pushState(null,'',location.href));
    document.onvisibilitychange = () => { if(document.hidden){ alert('No cheating!'); location.reload(); }};
  </script>
{% endblock %}